<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title">Loading...</title>
  <style>
    body {
      font-family: Futura, 'Trebuchet MS', Arial, sans-serif;
      background-color: #f4f6f9;
      padding: 20px;
      margin: 0;
      box-sizing: border-box;
    }
    *, *::before, *::after {
      box-sizing: inherit;
    }
    h1 {
      text-align: center;
      color: #003058;
      font-size: 2.5rem;
      margin-bottom: 30px;
    }
    .question {
      background: #ffffff;
      border: 2px dashed #003058;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 2px 2px 8px rgba(0, 150, 136, 0.1);
    }
    .choices label {
      display: block;
      background: #e6ecf2;
      border: 1px solid #d9dee8;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .choices label:hover {
      background-color: #ccd8e6;
    }
    .feedback {
      margin-top: 10px;
      font-weight: bold;
      font-style: italic;
    }
    .progress-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #ffffff;
      padding: 10px 20px;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      font-size: 1.1rem;
      display: none;
    }
    .progress-flex {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
    }
    .progress-bar {
      flex: 1 1 200px;
      margin-right: 20px;
      background-color: #dce3ee;
      border: 1px solid #003058;
      border-radius: 8px;
      overflow: hidden;
      min-width: 200px;
    }
    .progress-fill {
      height: 24px;
      background-color: #003058;
      width: 0%;
      text-align: center;
      color: white;
      font-weight: bold;
      line-height: 24px;
      transition: width 0.5s;
    }
    .progress-nav button, .summary-actions button {
      background-color: #003058;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      margin: 5px;
      cursor: pointer;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }
    .section {
      padding-bottom: 160px;
    }
    .summary {
      margin-top: 40px;
      background: #fff;
      border: 2px solid #003058;
      padding: 20px;
      border-radius: 12px;
    }
    .summary-actions {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1 id="quiz-title">üìò Loading Quiz Title... üìò</h1>
  <div id="start-container" style="text-align:center; margin-top: 50px;">
    <button id="start-button">Start Exam</button>
  </div>
  <div id="quiz" style="display:none;"></div>
  <div class="progress-container" id="progress-container">
    <div class="progress-flex">
      <div style="flex:1">
        <p>Score: <span id="score">0</span>/<span id="total">0</span> (<span id="percent">0</span>%)</p>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <p>Time: <span id="timer">00:00</span></p>
      </div>
      <div class="progress-nav">
        <button id="prev-button">Previous Section</button>
        <button id="next-button">Next Section</button>
      </div>
    </div>
  </div>
  <div id="review" class="summary" style="display:none;"></div>
<script>
let quizData = null;
let currentSectionIndex = 0;
let startTime, timerInterval;

fetch('quiz-data.json')
  .then(response => response.json())
  .then(data => {
    quizData = data;
    document.title = `WGU: ${data.title} OA Prep Exam`;
    document.getElementById('quiz-title').innerText = `üìò WGU: ${data.title} OA Prep Exam üìò`;
  });

function formatTime(seconds) {
  const m = String(Math.floor(seconds / 60)).padStart(2, '0');
  const s = String(seconds % 60).padStart(2, '0');
  return `${m}:${s}`;
}

function startTimer() {
  startTime = Date.now();
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    document.getElementById('timer').innerText = formatTime(elapsed);
  }, 1000);
}

function stopTimer() {
  clearInterval(timerInterval);
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function renderQuizSection(index) {
  const quizContainer = document.getElementById('quiz');
  quizContainer.innerHTML = '';
  const section = quizData.sections[index];
  const sectionDiv = document.createElement('div');
  sectionDiv.className = 'section';
  sectionDiv.innerHTML = `<h2>Section ${index + 1}: ${section.name}</h2>`;
  shuffle(section.questions);
  section.questions.forEach((q, i) => {
    const id = `q-${index}-${i}`;
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `<p><strong>${q.question}</strong></p>` +
      q.choices.map((c, ci) => `
        <label>
          <input type="radio" name="${id}" value="${ci}" onclick="showFeedback('${id}', ${ci}, ${q.correct.match(/\d+/)[0]-1}, ${JSON.stringify(q.explanation)})" /> ${c}
        </label>`).join('') +
      `<div class="feedback" id="feedback-${id}"></div>`;
    sectionDiv.appendChild(div);
  });
  quizContainer.appendChild(sectionDiv);
  updateProgress();
}

function showFeedback(id, selected, correct, explanation) {
  const fb = document.getElementById(`feedback-${id}`);
  const isCorrect = selected === correct;
  fb.innerHTML = isCorrect ? `‚úÖ Correct!<br>${explanation}` : `‚ùå Incorrect.<br>${explanation}`;
  updateProgress();
}

function updateProgress() {
  const totalEl = document.getElementById('total');
  const scoreEl = document.getElementById('score');
  const percentEl = document.getElementById('percent');
  const fillEl = document.getElementById('progress-fill');
  const feedbacks = document.querySelectorAll('.feedback');
  let total = 0, correct = 0;
  feedbacks.forEach(f => {
    if (f.innerHTML.includes('‚úÖ')) correct++;
    if (f.innerHTML) total++;
  });
  const percent = total ? Math.round((correct / total) * 100) : 0;
  totalEl.textContent = total;
  scoreEl.textContent = correct;
  percentEl.textContent = percent;
  fillEl.style.width = `${percent}%`;
}

function renderReview() {
  stopTimer();
  const review = document.getElementById('review');
  review.innerHTML = '<h2>Final Review</h2>';
  const summary = document.createElement('div');
  summary.innerHTML = `Score: ${document.getElementById('score').innerText} / ${document.getElementById('total').innerText}<br>` +
                      `Time: ${document.getElementById('timer').innerText}`;
  const missed = Array.from(document.querySelectorAll('.feedback'))
    .filter(f => f.innerHTML.includes('‚ùå'))
    .map(f => `<li>${f.parentElement.querySelector('p').innerText}<br>${f.innerHTML}</li>`);
  review.appendChild(summary);
  review.innerHTML += `<h3>Missed Questions</h3><ul>${missed.join('')}</ul>`;
  review.innerHTML += `<div class="summary-actions">
    <button onclick="location.reload()">Retake Exam</button>
    <button onclick="window.print()">Print</button>
    <button onclick="downloadCSV()">Export CSV</button>
  </div>`;
  review.style.display = 'block';
}

function downloadCSV() {
  let csv = 'Question,Result,Explanation\n';
  document.querySelectorAll('.question').forEach(q => {
    const question = q.querySelector('p').innerText.replace(/,/g, '');
    const fb = q.querySelector('.feedback');
    const result = fb.innerHTML.includes('‚úÖ') ? 'Correct' : 'Incorrect';
    const explanation = fb.innerText.split('\n').slice(1).join(' ').replace(/,/g, '');
    csv += `${question},${result},${explanation}\n`;
  });
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'quiz_results.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

document.getElementById('start-button').addEventListener('click', () => {
  document.getElementById('start-container').style.display = 'none';
  document.getElementById('quiz').style.display = 'block';
  document.getElementById('progress-container').style.display = 'block';
  renderQuizSection(currentSectionIndex);
  startTimer();
});

document.getElementById('prev-button').addEventListener('click', () => {
  if (currentSectionIndex > 0) {
    currentSectionIndex--;
    renderQuizSection(currentSectionIndex);
  }
});

document.getElementById('next-button').addEventListener('click', () => {
  if (currentSectionIndex < quizData.sections.length - 1) {
    currentSectionIndex++;
    renderQuizSection(currentSectionIndex);
  } else {
    document.getElementById('quiz').style.display = 'none';
    renderReview();
  }
});
</script>
</body>
</html>
